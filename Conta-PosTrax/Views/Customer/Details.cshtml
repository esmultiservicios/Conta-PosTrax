@model Conta_PosTrax.Models.Cliente

@{
	ViewData["Title"] = "Detalles del Cliente";
}

@section Scripts {
	<script src="~/js/Details.js?v=@DateTime.Now.Ticks"></script>
	<script src="~/js/customer.contacts.js?v=@DateTime.Now.Ticks"></script>
}

<div class="page-header">
	<div class="row align-items-center">
		<div class="col">
			<h3 class="page-title">@ViewData["Title"]</h3>
			<ul class="breadcrumb">
				<li class="breadcrumb-item">
					<a href="/">Dashboard</a>
				</li>
				<li class="breadcrumb-item">
					<a href="/Customer">Clientes</a>
				</li>
				<li class="breadcrumb-item active">Detalles</li>
			</ul>
		</div>
		<div class="col-auto">
			<a href="/Customer/EditCustomer/@Model.Id" class="btn btn-primary me-1">
				<i class="far fa-edit"></i> Editar
			</a>
			<a href="/Customer" class="btn btn btn-secondary">
				<i class="fas fa-arrow-left"></i> Volver
			</a>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-md-12">
		<div class="card">
			<div class="card-body">
				<h4 class="card-title">Información Básica</h4>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>Código:</label>
							<p class="form-control-static">@(Model.Codigo ?? "--")</p>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label>Nombre:</label>
							<p class="form-control-static">@Model.Nombre</p>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>RTN:</label>
							<p class="form-control-static">@(Model.RTN ?? "--")</p>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label>Tipo de Entidad:</label>
							<p class="form-control-static">@(Model.TipoEntidad ?? "--")</p>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>Teléfono:</label>
							<p class="form-control-static">@(Model.Telefono ?? "--")</p>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label>Email:</label>
							<p class="form-control-static">
								@if (!string.IsNullOrEmpty(Model.Email))
								{
									<a href="mailto:@Model.Email">@Model.Email</a>
								}
								else
								{
									<span>--</span>
								}
							</p>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="form-group">
							<label>Dirección:</label>
							<p class="form-control-static">@(Model.Direccion ?? "--")</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="card">
			<div class="card-body">
				<h4 class="card-title">Información Financiera</h4>
				<div class="row">
					<div class="col-md-4">
						<div class="form-group">
							<label>Saldo Actual:</label>
							<p class="form-control-static @(Model.Balance < 0 ? "text-danger" : "text-success")">
								@(Model.Balance?.ToString("C") ?? "--")
							</p>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label>Límite de Crédito:</label>
							<p class="form-control-static">@(Model.LimiteCredito?.ToString("C") ?? "--")</p>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label>Términos de Pago:</label>
							<p class="form-control-static">@(Model.TerminoPago?.ToString() ?? "--") días</p>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-4">
						<div class="form-group">
							<label>Descuento:</label>
							<p class="form-control-static">@(Model.Descuento?.ToString("P") ?? "--")</p>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label>Lista de Precios:</label>
							<p class="form-control-static">@(Model.ListaPrecio?.ToString() ?? "--")</p>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label>Moneda:</label>
							<p class="form-control-static">@(Model.Moneda ?? "--")</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Sección de Contactos -->
		<div class="card">
			<div class="card-body">
				<div class="d-flex justify-content-between align-items-center">
					<h4 class="card-title mb-0">Contactos</h4>
					<button type="button"
							class="btn btn-primary btn-sm"
							data-bs-toggle="modal"
							data-bs-target="#createContactModal"
							onclick="openCreateContactModal(@Model.Id)">
						<i class="fas fa-plus"></i> Agregar Contacto
					</button>
				</div>

				@if (Model.Contactos.Any())
				{
					<div class="table-responsive mt-3">
						<div id="contacts-container">
							@await Html.PartialAsync("_ContactsTable", Model.Contactos)
						</div>
					</div>
				}
				else
				{
					<div class="alert alert-info mt-3">
						No se han registrado contactos para este cliente.
					</div>
				}
			</div>
		</div>

		<div class="card">
			<div class="card-body">
				<h4 class="card-title">Información Adicional</h4>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>Fecha de Registro:</label>
							<p class="form-control-static">@Model.CreatedAt?.ToString("dd/MM/yyyy HH:mm")</p>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label>Última Actualización:</label>
							<p class="form-control-static">@Model.UpdatedAt?.ToString("dd/MM/yyyy HH:mm")</p>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label>Notas:</label>
					<p class="form-control-static">@(Model.Notas ?? "Sin notas adicionales")</p>
				</div>
			</div>
		</div>
	</div>
</div>

@await Html.PartialAsync("_ContactsModals")