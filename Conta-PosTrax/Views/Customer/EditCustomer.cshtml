@model Conta_PosTrax.Models.Cliente

@{
	ViewData["Title"] = "Editar Cliente";
}

@section Scripts {
	<script src="~/js/EditCustomer.js?v=@DateTime.Now.Ticks"></script>
	<script src="~/js/customer.contacts.js?v=@DateTime.Now.Ticks"></script>
}

<div class="page-header">
	<div class="row align-items-center">
		<div class="col">
			<h3 class="page-title">@ViewData["Title"]</h3>
			<ul class="breadcrumb">
				<li class="breadcrumb-item"><a href="/">Dashboard</a></li>
				<li class="breadcrumb-item"><a href="/Customer">Clientes</a></li>
				<li class="breadcrumb-item active">Editar Cliente</li>
			</ul>
		</div>
		<div class="col-auto">
			<a href="/Customer" class="btn btn-secondary">
				<i class="fas fa-arrow-left"></i> Volver
			</a>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-md-12">
		<div class="card">
			<div class="card-body">
				<h4 class="card-title">Información Básica</h4>
				<form id="editCustomerForm"
					  asp-controller="Customer"
					  asp-action="EditCustomer"
					  asp-route-id="@Model.Id"
					  method="post">
					@Html.AntiForgeryToken()
					<input type="hidden" asp-for="Id" id="Id" />

					<div class="row">
						<div class="col-md-6">
							<div class="form-group">
								<label asp-for="Codigo">Código</label>
								<input type="text" class="form-control" asp-for="Codigo">
							</div>
							<div class="form-group">
								<label asp-for="Nombre">Nombre *</label>
								<input type="text" class="form-control mayusculas" asp-for="Nombre" required>
							</div>
							<div class="form-group">
								<label asp-for="RTN">RTN</label>
								<input type="text" class="form-control" asp-for="RTN">
							</div>
							<div class="form-group">
								<label asp-for="TipoEntidad">Tipo de Entidad</label>
								<select class="form-control" asp-for="TipoEntidad">
									<option value="">Seleccione...</option>
									<option value="C">Compañía</option>
									<option value="G">Gobierno</option>
									<option value="I">Individual</option>
								</select>
							</div>
							<div class="form-group">
								<label asp-for="Tipo">Tipo</label>
								<select class="form-control" asp-for="Tipo">
									<option value="C">Cliente</option>
									<option value="S">Proveedor</option>
									<option value="L">Lead</option>
								</select>
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group">
								<label asp-for="Telefono">Teléfono *</label>
								<input type="text" class="form-control" asp-for="Telefono" required>
							</div>
							<div class="form-group">
								<label asp-for="Telefono2">Teléfono 2</label>
								<input type="text" class="form-control" asp-for="Telefono2">
							</div>
							<div class="form-group">
								<label asp-for="Email">Email *</label>
								<input type="email" class="form-control" asp-for="Email" required>
							</div>
							<div class="form-group">
								<label asp-for="Contacto">Contacto Principal</label>
								<input type="text" class="form-control mayusculas" asp-for="Contacto">
							</div>
							<div class="form-group">
								<label asp-for="NombreSocioPrincipal">Nombre Socio Principal</label>
								<input type="text" class="form-control mayusculas" asp-for="NombreSocioPrincipal">
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="form-group">
								<label asp-for="Direccion">Dirección</label>
								<textarea class="form-control" asp-for="Direccion" rows="3"></textarea>
							</div>
						</div>
					</div>

					<h4 class="card-title mt-4">Información Financiera</h4>
					<div class="row">
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="Balance">Saldo Actual</label>
								<input type="text" class="form-control currency-input" asp-for="Balance">
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="ChecksBal">Saldo en Cheques</label>
								<input type="text" class="form-control currency-input" asp-for="ChecksBal">
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="LimiteCredito">Límite de Crédito</label>
								<input type="text" class="form-control currency-input" asp-for="LimiteCredito">
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="TerminoPago">Términos de Pago (días)</label>
								<input type="number" class="form-control" asp-for="TerminoPago">
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="Descuento">Descuento (%)</label>
								<input type="number" step="0.01" class="form-control" asp-for="Descuento">
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="ListaPrecio">Lista de Precios</label>
								<select class="form-control" asp-for="ListaPrecio">
									<option value="1">Lista 1</option>
									<option value="2">Lista 2</option>
									<option value="3">Lista 3</option>
								</select>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="Moneda">Moneda</label>
								<select class="form-control" asp-for="Moneda">
									<option value="HNL">Lempiras (HNL)</option>
									<option value="USD">Dólares (USD)</option>
								</select>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="Pais">País</label>
								<select class="form-control" asp-for="Pais">
									<option value="1">Honduras</option>
									<option value="2">Estados Unidos</option>
									<option value="3">Guatemala</option>
									<option value="4">El Salvador</option>
									<option value="5">Nicaragua</option>
									<option value="6">Costa Rica</option>
								</select>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label asp-for="Ciudad">Ciudad</label>
								<select class="form-control" asp-for="Ciudad">
									<option value="1">Tegucigalpa</option>
									<option value="2">San Pedro Sula</option>
									<option value="3">La Ceiba</option>
									<option value="4">Comayagua</option>
								</select>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="form-group">
								<label asp-for="CuentaContable">Cuenta Contable</label>
								<input type="text" class="form-control" asp-for="CuentaContable" />
							</div>
						</div>
						<div class="col-md-6">
							<div class="form-group">
								<label asp-for="VendedorAsignado">Vendedor Asignado</label>
								<select class="form-control" asp-for="VendedorAsignado">
									<option value="1">Vendedor 1</option>
									<option value="2">Vendedor 2</option>
									<option value="3">Vendedor 3</option>
								</select>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="form-group">
								<label asp-for="Notas">Notas</label>
								<textarea class="form-control" asp-for="Notas" rows="3"></textarea>
							</div>
						</div>
					</div>

					<div class="text-end mt-4">
						<button type="button" class="btn btn-secondary" onclick="window.location.href='/Customer'">
							<i class="fas fa-times"></i> Cancelar
						</button>
						<button type="submit" class="btn btn-primary">
							<i class="fas fa-save"></i> Guardar Cambios
						</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Sección de Contactos -->
		<div class="card">
			<div class="card-body">
				<div class="d-flex justify-content-between align-items-center">
					<h4 class="card-title mb-0">Contactos</h4>
					<button type="button"
							class="btn btn-primary btn-sm"
							data-bs-toggle="modal"
							data-bs-target="#createContactModal"
							onclick="openCreateContactModal(@Model.Id)">
						<i class="fas fa-plus"></i> Agregar Contacto
					</button>
				</div>

				@if (Model.Contactos.Any())
				{
					<div class="table-responsive mt-3">
						<div id="contacts-container">
							@await Html.PartialAsync("_ContactsTable", Model.Contactos)
						</div>
					</div>
				}
				else
				{
					<div class="alert alert-info mt-3">
						No se han registrado contactos para este cliente.
					</div>
				}
			</div>
		</div>

		<div class="card">
			<div class="card-body">
				<h4 class="card-title">Información Adicional</h4>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>Fecha de Registro:</label>
							<p class="form-control-static">@Model.CreatedAt?.ToString("dd/MM/yyyy HH:mm")</p>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label>Última Actualización:</label>
							<p class="form-control-static">@Model.UpdatedAt?.ToString("dd/MM/yyyy HH:mm")</p>
						</div>
					</div>
				</div>
				<div class="form-group">
					<label>Notas:</label>
					<p class="form-control-static">@(Model.Notas ?? "Sin notas adicionales")</p>
				</div>
			</div>
		</div>
	</div>
</div>

@await Html.PartialAsync("_ContactsModals")